<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cybersecurity Awareness Quiz</title>
  <link rel="stylesheet" href="../../assets/css/iamtrojan.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    body {
      background: #535252;
      color: #fff;
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    h2 {
      color: #00f0ff;
      text-align: center;
    }
    .quiz-container {
      max-width: 900px;
      margin: auto;
      padding: 20px;
      background: #1a1f2b;
      border-radius: 10px;
      box-shadow: 0 0 10px #00f0ff;
    }
    .question {
      margin-bottom: 25px;
    }
    .question p {
      font-weight: bold;
    }
    button {
      background-color: #00f0ff;
      color: #000;
      font-weight: bold;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #result {
      text-align: center;
      font-size: 1.2rem;
      margin-top: 20px;
      color: #0f0;
    }
    .tagline2q{
        color: #fff;
        font-weight: bold;
    }
  </style>
</head>

<body>

    <header style="text-align: center; padding: 20px;">
      <h1 class="glitch">
        <a href="iamtrojan.html" style="text-decoration: none;"><img src="../../assets/images/iamtrojanlogoresize.png" class="glitch11" alt=" iamÃ·TroJan-Logo"></a>
      </h1>
      <p class="tagline2q">Empowering You with Cybersecurity Awareness</p>
    </header>

  <h2>Beginner's Quiz (for testing and promotion with certificate issuing)</h2>

  <div class="quiz-container">
    <form id="quizForm">
      <!-- Questions (Generated Below) -->
    </form>
    <div id="result"></div>
    <div id="certificateSection" style="text-align:center; margin-top: 30px;">
  <button id="generateCertBtn" style="display:none;" onclick="generatePDF()">ðŸŽ“ Download Your Certificate (PDF)</button>
</div>


    <!-- Hidden Certificate Section -->
<div id="certificate" style="display:none; margin-top:30px; text-align:center; background:#fff; color:#000; padding:30px; border-radius:10px; max-width:600px; margin:auto;">
  <h2 style="color:#00f0ff;">Certificate of Completion</h2>
  <p>This certifies that</p>
  <h3 id="certName">[Name]</h3>
  <p>has successfully passed the</p>
  <h4>Cybersecurity Awareness Quiz</h4>
  <p>Date: <span id="certDate"></span></p>
  <button onclick="downloadCertificate()">Download Certificate</button>
</div>

    <div id="certPreviewContainer" style="margin-top: 30px; text-align: center;"></div>

    <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://dammy-hawey.github.io/iamtrojan_updated"
   target="_blank"
   style="display:inline-block;margin-top:20px;background:#0077b5;color:#fff;padding:8px 16px;border-radius:4px;font-weight:bold;">
  Share on LinkedIn
</a>
    <a href="quiz.html"
   target="_blank"
   style="display:inline-block;margin-top:20px;background:#0077b5;color:#fff;padding:8px 16px;border-radius:4px;font-weight:bold;">
  Main Quiz Page
</a>
  </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- Add jsPDF library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
  const { jsPDF } = window.jspdf;

//   const questions = [/*... your quiz questions (same as before) ...*/];
        const questions = [
    {
      q: "1. What is phishing?",
      options: ["A type of fish", "A cyberattack to steal credentials", "Email for marketing", "System error"],
      answer: "A cyberattack to steal credentials"
    },
    {
      q: "2. What should you do if you receive a suspicious email?",
      options: ["Click the link to see more", "Ignore and delete it", "Forward it to friends", "Reply to sender"],
      answer: "Ignore and delete it"
    },
    {
      q: "3. What does a secure website URL start with?",
      options: ["http://", "ftp://", "https://", "file://"],
      answer: "https://"
    },
    {
      q: "4. Which of these is a common sign of phishing?",
      options: ["Perfect grammar", "Sender from your contact list", "Urgent or threatening language", "Secure padlock icon"],
      answer: "Urgent or threatening language"
    },
    {
      q: "5. What should you do before clicking any link in an email?",
      options: ["Nothing", "Check the sender", "Hover to preview the URL", "Forward to IT team"],
      answer: "Hover to preview the URL"
    },
    {
      q: "6. Whatâ€™s the best way to protect your account?",
      options: ["Use easy passwords", "Share passwords", "Enable 2FA", "Use same password everywhere"],
      answer: "Enable 2FA"
    },
    {
      q: "7. What does 2FA stand for?",
      options: ["2-Factor Authentication", "2-Factor Approval", "Twice Fast Access", "Two-way Firewall Authentication"],
      answer: "2-Factor Authentication"
    },
    {
      q: "8. Which of these should be kept private?",
      options: ["Your email signature", "Your phone wallpaper", "Your password", "Your playlist"],
      answer: "Your password"
    },
    {
      q: "9. What should you avoid on public Wi-Fi?",
      options: ["Watching videos", "Social media", "Online banking", "Searching Google"],
      answer: "Online banking"
    },
    {
      q: "10. A phishing website may look like:",
      options: ["Your bankâ€™s login page", "Social media login", "Popular stores", "All of the above"],
      answer: "All of the above"
    },
    {
    "q": "11. Why is Social Engineering dangerous?",
    "options": [
      "It increases security",
      "It can lead to data theft",
      "It boosts battery",
      "It makes apps free"
    ],
    "answer": "It can lead to data theft"
  },
  {
    "q": "12. What is Phishing?",
    "options": [
      "A type of attack",
      "A computer brand",
      "A coding language",
      "None of the above"
    ],
    "answer": "A type of attack"
  },
  {
    "q": "13. What is Passwords?",
    "options": [
      "A type of attack",
      "A computer brand",
      "A coding language",
      "None of the above"
    ],
    "answer": "A type of attack"
  },
  {
    "q": "14. How can you prevent 2FA?",
    "options": [
      "Ignore it",
      "Use strong passwords",
      "Click all links",
      "Always reply"
    ],
    "answer": "Use strong passwords"
  },
  {
    "q": "15. How can you prevent Malware?",
    "options": [
      "Ignore it",
      "Use strong passwords",
      "Click all links",
      "Always reply"
    ],
    "answer": "Use strong passwords"
  },
  {
    "q": "16. The following are the ways to respond to a phishing ATTACT except?",
    "options": [
      "Check sender reputation and email anomalies.",
      "Using tools like; VirusTotal, URLScan, and IPVoid to analyze email headers and link.",
      "Delete all possible messages.",
      "Quarantine the email and report to the security teams"
    ],
    "answer": "Delete all possible messages"
  }
  ];

  const form = document.getElementById("quizForm");
  const result = document.getElementById("result");
  const previewContainer = document.getElementById("certPreviewContainer");

  // Render questions
  questions.forEach((q, index) => {
    const div = document.createElement("div");
    div.className = "question";
    div.innerHTML = `<p>${q.q}</p>` + q.options.map(opt =>
      `<label><input type="radio" name="q${index}" value="${opt}" required> ${opt}</label><br>`
    ).join("");
    form.appendChild(div);
  });

  // Submit Button
  const submitBtn = document.createElement("button");
  submitBtn.type = "submit";
  submitBtn.textContent = "Submit Quiz";
  submitBtn.style.marginTop = "20px";
  form.appendChild(submitBtn);

  form.onsubmit = async function (e) {
    e.preventDefault();
    let score = 0;
    questions.forEach((q, i) => {
      const selected = form.querySelector(`input[name="q${i}"]:checked`);
      if (selected && selected.value === q.answer) score++;
    });

    result.innerHTML = `ðŸŽ‰ You scored <strong>${score}</strong> out of <strong>${questions.length}</strong>!`;

    if (score >= 7) {
      const fullName = prompt("Enter your full name for the certificate:") || "Cyber Warrior";
      const certId = "TJN-" + Math.floor(100000 + Math.random() * 900000);
      const date = new Date().toLocaleDateString();

      // Preview first
      await generateCertificate(fullName, certId, date, true);

      // Save for admin
      fetch("/save-certificate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name: fullName, score, certId, date })
      }).then(res => res.json()).then(data => {
        console.log("âœ”ï¸ Certificate recorded:", data);
      });
    } else {
      alert("âŒ You need at least 7 correct answers to earn a certificate.");
    }
  };

  async function generateCertificate(name, certId, date, previewOnly = false) {
    const doc = new jsPDF("landscape", "pt", "a4");
    const pageWidth = doc.internal.pageSize.getWidth();

    // Background
    doc.setFillColor("#0d1117");
    doc.rect(0, 0, pageWidth, doc.internal.pageSize.getHeight(), "F");

    // Logo centered
    const logoUrl = "https://dammy-hawey.github.io/iamtrojan_updated/assets/images/Trojanlogo.png";
    try {
      const img = await loadImage(logoUrl);
      doc.addImage(img, "PNG", (pageWidth - 100) / 2, 30, 100, 100);
    } catch (err) {
      console.warn("Logo failed to load:", err);
    }

    // Text content
    doc.setFont("helvetica", "bold");
    doc.setFontSize(32);
    doc.setTextColor("#00f0ff");
    doc.text("Certificate of Completion", pageWidth / 2, 160, { align: "center" });

    doc.setFontSize(18);
    doc.setFont("helvetica", "normal");
    doc.setTextColor("#fff");
    doc.text("This certifies that", pageWidth / 2, 200, { align: "center" });

    doc.setFontSize(24);
    doc.setFont("helvetica", "bold");
    doc.setTextColor("#00f0ff");
    doc.text(name, pageWidth / 2, 240, { align: "center" });

    doc.setFontSize(18);
    doc.setTextColor("#fff");
    doc.setFont("helvetica", "normal");
    doc.text("has successfully completed the", pageWidth / 2, 280, { align: "center" });
    doc.text("Cybersecurity Awareness Quiz", pageWidth / 2, 310, { align: "center" });

    doc.setFontSize(14);
    doc.setTextColor("#aaa");
    doc.text(`Certificate ID: ${certId}`, 100, 370);
    doc.text(`Date: ${date}`, 100, 390);

    doc.setFontSize(12);
    doc.setTextColor("#00f0ff");
    doc.text("iamÃ·TroJan â€” Empowering Digital Safety", pageWidth / 2, 520, { align: "center" });

    // Preview canvas
    if (previewOnly) {
      const preview = document.createElement("canvas");
      const imgData = doc.output("dataurlstring");
      const img = new Image();
      img.src = imgData;
      img.style.width = "100%";
      previewContainer.innerHTML = ""; // clear old
      previewContainer.appendChild(img);

      const btn = document.createElement("button");
      btn.textContent = "Download Certificate as PDF";
      btn.style.marginTop = "20px";
      btn.onclick = () => doc.save(`iamTrojan_Certificate_${certId}.pdf`);
      previewContainer.appendChild(btn);
    }
  }

  function loadImage(url) {
    return new Promise((resolve, reject) => {
      const img = new Image();
      img.crossOrigin = "anonymous";
      img.onload = () => resolve(img);
      img.onerror = reject;
      img.src = url;
    });
  }
</script>
  
  
</body>
</html>